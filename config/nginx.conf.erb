daemon off;
worker_processes auto;

events {
	worker_connections 32768;
	use epoll;
	multi_accept on;
}

stream {
    upstream web_server {
	server 127.0.0.1:<%= ENV['PORT'] %>;
    }

    # Proxy tcp back to app
    server {
        listen 0.0.0.0:<%= ENV['HEROKU_ROUTER_HTTP_PORT'] || 5001 %>;
        proxy_pass web_server;
    }

    # Listen on healthcheck port
    server {
	listen 0.0.0.0:<%= ENV['HEROKU_ROUTER_HEALTHCHECK_PORT'] || 6000 %>;
    }
}
